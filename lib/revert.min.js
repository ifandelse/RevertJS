/**
 * RevertJS - Add undo/redo behavior to your JavaScript objects.
 * Author: Jim Cowart (http://freshbrewedcode.com/jimcowart)
 * Version: v0.0.1
 * Url: https://github.com/ifandelse/RevertJS
 * License(s): MIT
 */
(function(n,t){"object"==typeof module&&module.exports?module.exports=function(){var n=require("gnosis");return t(n)}:"function"==typeof define&&define.amd?define(["gnosis"],function(n){return t(n)}):n.revertjs=t(n.gnosis)})(this,function(n,t){var _=n.traverse.exclude;_.splice(_.length,0,"undo","redo","__changes__","__inProgress__","__position__","__addHistory__");var e=function(n,t,_,e,i,s){var r=n[t];n[t]=function(){var _=o.clone(n);r.apply(n,arguments),s.__addHistory__({changeType:"mutation",path:i.slice(0,i.length-t.length-1),oldVal:_,newVal:o.clone(n)}),s.rescan()}},i=function(t,_,e,i,s,r){var a=e;Object.defineProperty(t,_,{enumerable:!0,configurable:!0,get:function(){return a},set:function(t){var _=o.clone(a),e=n.getType(_),i=n.getType(t);a=t,r.__addHistory__({changeType:"assignment",path:s,oldVal:_,newVal:o.clone(t)}),(e!==i||"object"===i||"array"===i)&&r.rescan()}})},o=function(t,_,o){var s;for(var s in t)(_.allTargetMembers||t.hasOwnProperty(s))&&(this[s]=t[s]);var r=function(t,_,o,s,r,a){"function"===s&&"array"===n.getType(t)&&-1!==n.traverse.arrayMembers.indexOf(_)?e(t,_,o,s,r,a):"function"!==s&&i(t,_,o,s,r,a)};n.traverse(this,r,_,o),this.__changes__=[],this.__position__=0,this.__inProgress__=!1};o.clone=function(n){return JSON.parse(JSON.stringify(n))},o.prototype.__addHistory__=function(n){this.__inProgress__||(this.__position__!==this.__changes__.length-1&&(this.__changes__=this.__changes__.slice(0,this.__position__)),this.__changes__.push(n),this.__position__=this.__changes__.length-1)};var s=function(n){return n>=0&&n<this.__changes__.length},r=function(_){var e=this.__changes__[this.__position__];setFn="mutation"===e.changeType?function(n,t){var _=[0,n.length].concat(o.clone(t));Array.prototype.splice.apply(n,_)}:t,n.setValFromPath(this,e.path,o.clone("undo"===_?e.oldVal:e.newVal),setFn)};return o.prototype.undo=function(n){for(n=n||1,this.__inProgress__=!0;n>0&&s.call(this,this.__position__);)r.call(this,"undo"),this.__position__-=1,n-=1;this.__inProgress__=!1},o.prototype.redo=function(n){for(n=n||1,this.__inProgress__=!0;n>0&&s.call(this,this.__position__+1);)this.__position__+=1,r.call(this,"redo"),n-=1;this.__inProgress__=!1},{Undoable:o}});