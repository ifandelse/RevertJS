/**
 * RevertJS - Add undo/redo behavior to your JavaScript objects.
 * Author: Jim Cowart (http://freshbrewedcode.com/jimcowart)
 * Version: v0.0.1
 * Url: https://github.com/ifandelse/RevertJS
 * License(s): MIT
 */
(function(n,e){"object"==typeof module&&module.exports?module.exports=function(){var n=require("gnosis");return e(n)}:"function"==typeof define&&define.amd?define(["gnosis"],function(n){return e(n)}):n.revertjs=e(n.gnosis)})(this,function(n,e){var o=n.traverse.exclude;o.splice(o.length,0,"undo","undoTo","_changes","_undoInProgress");var t=function(n,e,o,t){for(var r=1,s=e.split("."),a=s.length,i=a-1,u=n;a>r;)r!==i?u=u[s[r]]:t?t(u[s[r]],o):u[s[r]]=o,r+=1},r=function(n,e,o,t,r,s){var i=n[e];n[e]=function(){var o=a.clone(n);i.apply(n,arguments),s._undoInProgress||s._changes.push({changeType:"mutation",path:r.slice(0,r.length-e.length-1),oldVal:o}),s.rescan()}},s=function(e,o,t,r,s,i){var u=t;Object.defineProperty(e,o,{enumerable:!0,configurable:!0,get:function(){return u},set:function(e){var o=a.clone(u),t=n.getType(o),r=n.getType(e);u=e,i._undoInProgress||i._changes.push({changeType:"assignment",path:s,oldVal:o}),(t!==r||"object"===r||"array"===r)&&i.rescan()}})},a=function(e,o,t){var a;for(var a in e)(o.allTargetMembers||e.hasOwnProperty(a))&&(this[a]=e[a]);var i=function(e,o,t,a,i,u){"function"===a&&"array"===n.getType(e)&&-1!==n.traverse.arrayMembers.indexOf(o)?r(e,o,t,a,i,u):"function"!==a&&s(e,o,t,a,i,u)};n.traverse(this,i,o,t),this._changes=[],this._undoInProgress=!1};return a.clone=function(n){return JSON.parse(JSON.stringify(n))},a.prototype.undo=function(n){var o,r;for(this._undoInProgress=!0,n=n||1;n>0&&(o=this._changes.pop());)r="mutation"===o.changeType?function(n,e){var o=[0,n.length].concat(a.clone(e));Array.prototype.splice.apply(n,o)}:e,t(this,o.path,a.clone(o.oldVal),r),n-=1;this._undoInProgress=!1},a.prototype.undoTo=function(n){var e=this._changes.length-1;if(n>e)throw new Error("The change history only goes up to index "+e+" but you wanted to undo to index "+n+".");this.undo(e-n+1)},{Undoable:a}});